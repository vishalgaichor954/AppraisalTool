@using Newtonsoft.Json;
@model List<AppraisalTool.App.Models.updateSelfAppraisalVM>
@{
    dynamic json = JsonConvert.DeserializeObject(Context.Session.GetString("navbarViewModel"));
}


<style>
    .Button {
        background-color: #1746A2;
        color: white;
        /* border: 2px solid #E0144C;*/
        border-radius: 0.3rem;
        border: none;
        padding: 13px 40px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin: 4px 2px;
        cursor: pointer;
        width: auto;
    }</style>

@{
    //ViewData["Title"] = "AppraisalTool";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@{
    var EffortList1 = Model.Where(item => item.List_Id == 1).ToList();
    var EffortList = Model.Where(item => item.List_Id == 1).ToList().Count;
    var BevList = Model.Where(item => item.List_Id == 3).ToList().Count;
    var JobList = Model.Where(item => item.List_Id == 4).ToList().Count;
}



<div class="container d-flex justify-content-center">
    <div class="col-11">
        <div class="card content-wrapper-red">
            <div class="card-body">


                <div class="d-flex justify-content-between">
                    <h1 class="card-title FormHeader" style="display:inline">Self Appraisal</h1>
                    <input type="button" value="Back" class=" Button mb-4" onclick="history.back()" />
                </div>


                <div class="featureBackground ">
                    <form class="form-sample needs-validation" asp-action="AddSelfAppraisal" method="post" enctype="multipart/form-data" novalidate>
                        <div class="text-danger"></div>
                        <input name="Fid" hidden value="@ViewBag.Fid" type="number">

                        @if (ViewBag.IsEditable != 0)
                        {
                            <input name="IsEditable" hidden value="@ViewBag.IsEditable" type="number">
                            <input name="AppraisalID" hidden value="@ViewBag.appraisalData.Id" type="number">

                        }



                        <fieldset class="border p-2 m-3 " style="display:flex;justify-content:center;">
                            <legend class="float-none HEADdata w-auto">
                                Input & Effort metric
                            </legend>
                            <div class="row d-flex justify-content-center">

                                @for (int i = 0; i < EffortList; i++)
                                {
                                    int count = i + 1;
                                    <div class="row pt-3 m-3 " style="border:1px solid lightgrey;width:93%;border-radius:0.2rem">
                                        <div class="row">
                                            <div class="col-9"><h4 class="HEADMetrics"> @count .  @Model[i].Metric_Description </h4></div>
                                            <div class="col-3"> <span style="color:black;font-style:italic;font-size:13px"> (Weightage @Model[i].metric_Weightage pts) </span> </div>
                                            @* <div class="col-3">
                                        <div class="row d-flex justify-content-center align-items-center">
                                        <div class="col-5">
                                        <label>Score</label>
                                        </div>
                                        <div class="col-7">
                                        <input class=" form-control my-2 kra-score" asp-for="@Model[i].Score" min="1" max="5" type="number" />
                                        </div>
                                        <span asp-validation-for="@Model[i].Score" class="text-danger mx-1 small"></span>
                                        </div>
                                        </div>*@
                                        </div>
                                        <div class="row pt-3 pb-1">
                                            <div class="col-3">
                                                <h4 class="DarkBlueP "> Score<sup class="required">*</sup></h4>

                                            </div>
                                            <div class="col-9">
                                                <h4 class="DarkBlueP "> Self Comment</h4>
                                            </div>

                                        </div>
                                        <div class="row pb-3">
                                            <div class="col-3">
                                                <div class="row d-flex justify-content-center align-items-center">
                                                    @* <div class="col-5">
                                                <label>Score</label>
                                                </div>*@
                                                    <div class="col-12">
                                                        @* <input class=" form-control my-2 kra-score" asp-for="@Model[i].Score" min="1" max="5" type="number" />*@
                                                        <select asp-for="@Model[i].Score" class="form-control form-select p-3" required>
                                                            <option value="">Pts</option>
                                                            <option value="1">1</option>
                                                            <option value="2">2</option>
                                                            <option value="3">3</option>
                                                            <option value="4">4</option>
                                                            <option value="5">5</option>
                                                        </select>


                                                    </div>

                                                </div>
                                            </div>
                                            <div class="col-9">
                                                <input asp-for="@Model[i].Metric_ID" hidden value="@Model[i].Metric_ID" type="number">
                                                <input asp-for="@Model[i].Id" hidden value="@Model[i].Id" type="number">
                                                <input asp-for="@Model[i].List_Id" hidden value="@Model[i].List_Id" type="number">
                                                <input asp-for="@Model[i].metric_Weightage" hidden value="@Model[i].metric_Weightage" type="number">
                                                <input asp-for="@Model[i].Metric_Description" hidden value="@Model[i].Metric_Description" type="text">
                                                <textarea class="form-control " asp-for="@Model[i].Comment" placeholder="Add Comment"></textarea>

                                            </div>
                                        </div>
                                        <div class="row">

                                            <div class="col-3"> @* <span asp-validation-for="@Model[i].Score" class="text-danger mx-1 small"></span>*@</div>
                                            <div class="col-9">@*<span asp-validation-for="@Model[i].Comment" class="text-danger   mx-1 small"></span>*@</div>
                                        </div>
                                    </div>
                                    @* <div class="row pt-2">
                                <div class="row">
                                <div class="col-9"><h4 class="HEADMetrics">@Model[i].Metric_Description</h4></div>
                                <div class="col-3">
                                <div class="row d-flex justify-content-center align-items-center">
                                <div class="col-5">
                                <label>Score<sup class="required">*</sup></label>
                                </div>
                                <div class="col-7">
                                <input class=" form-control my-2 kra-score" asp-for="@Model[i].Score" min="1" max="5" type="number">
                                </div>
                                </div>
                                </div>

                                </div>
                                <div class="row">
                                <input asp-for="@Model[i].Metric_ID" hidden value="@Model[i].Metric_ID"  type="number">
                                <input asp-for="@Model[i].List_Id" hidden value="@Model[i].List_Id"   type="number">
                                <input asp-for="@Model[i].metric_Weightage" hidden value="@Model[i].metric_Weightage"   type="number">
                                <input asp-for="@Model[i].Metric_Description" hidden  value="@Model[i].Metric_Description"  type="text">
                                <div class="col-12"> <textarea class="form-control " asp-for="@Model[i].Comment" placeholder="Add Comment"></textarea></div>

                                </div>
                                <span asp-validation-for="@Model[i].Comment" class="text-danger   mx-1 small"></span>
                                <span asp-validation-for="@Model[i].Score" class="text-danger mx-1 small"></span>
                                </div>*@

                                }
                            </div>
                        </fieldset>
                        <fieldset class="border p-2 m-3" style="display:flex;justify-content:center;">
                            <legend class="float-none HEADdata w-auto">
                                Behavioral competencies
                            </legend>
                            <div class="row d-flex justify-content-center">
                                @* <div class="row pt-3 pb-1">
                                <div class="col-3">
                                <h4 class="DarkBlueP "> Metric Name</h4>

                                </div>
                                <div class="col-3">
                                <h4 class="DarkBlueP "> Score<sup class="required">*</sup></h4>
                                </div>
                                <div class="col-3">
                                <h4 class="DarkBlueP "> Self Comment</h4>
                                </div>
                                </div>*@
                                @for (int i = EffortList - 1; i < EffortList + BevList - 1; i++)
                                {
                                    var temp = i + 1;
                                    int count = i + 2;
                                    <div class="row pt-3 m-3 " style="border:1px solid lightgrey;width:93%;border-radius:0.2rem">
                                        <div class="row">
                                            <div class="col-9"><h4 class="HEADMetrics"> @count .  @Model[temp].Metric_Description </h4></div>
                                            <div class="col-3"> <span style="color:black;font-style:italic;font-size:13px"> (Weightage @Model[temp].metric_Weightage pts) </span> </div>
                                            @* <div class="col-3">
                                        <div class="row d-flex justify-content-center align-items-center">
                                        <div class="col-5">
                                        <label>Score</label>
                                        </div>
                                        <div class="col-7">
                                        <input class=" form-control my-2 kra-score" asp-for="@Model[i].Score" min="1" max="5" type="number" />
                                        </div>
                                        <span asp-validation-for="@Model[i].Score" class="text-danger mx-1 small"></span>
                                        </div>
                                        </div>*@
                                        </div>
                                        <div class="row pt-3 pb-1">
                                            <div class="col-3">
                                                <h4 class="DarkBlueP "> Score<sup class="required">*</sup></h4>

                                            </div>
                                            <div class="col-9">
                                                <h4 class="DarkBlueP "> Self Comment</h4>
                                            </div>

                                        </div>
                                        <div class="row pb-3">
                                            <div class="col-3">
                                                <div class="row d-flex justify-content-center align-items-center">
                                                    @* <div class="col-5">
                                                <label>Score</label>
                                                </div>*@
                                                    <div class="col-12">
                                                        @*<input class=" form-control my-2 kra-score" asp-for="@Model[temp].Score" min="1" max="5" type="number" />*@
                                                        <select required asp-for="@Model[temp].Score" class="form-control form-select p-3">
                                                            <option value="">Pts</option>
                                                            <option value="1">1</option>
                                                            <option value="2">2</option>
                                                            <option value="3">3</option>
                                                            <option value="4">4</option>
                                                            <option value="5">5</option>



                                                        </select>
                                                    </div>
                                                    @*<span asp-validation-for="@Model[temp].Score" class="text-danger mx-1 small"></span>*@
                                                </div>
                                            </div>
                                            <div class="col-9">
                                                <input asp-for="@Model[temp].Metric_ID" hidden value="@Model[temp].Metric_ID" type="number">
                                                <input asp-for="@Model[temp].Id" hidden value="@Model[temp].Id" type="number">
                                                <input asp-for="@Model[temp].List_Id" hidden value="@Model[temp].List_Id" type="number">
                                                <input asp-for="@Model[temp].metric_Weightage" hidden value="@Model[temp].metric_Weightage" type="number">
                                                <input asp-for="@Model[temp].Metric_Description" hidden value="@Model[temp].Metric_Description" type="text">
                                                <textarea class="form-control " asp-for="@Model[temp].Comment" placeholder="Add Comment"></textarea>
                                                @*<span asp-validation-for="@Model[temp].Comment" class="text-danger   mx-1 small"></span>*@
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        </fieldset>
                        <fieldset class="border  p-2 m-3" style="display:flex;justify-content:center;">
                            <legend class="float-none HEADdata w-auto">
                                Job family grooming
                            </legend>
                            <div class="row d-flex justify-content-center">
                                @*<div class="row pt-3 pb-1">
                                <div class="col-3">
                                <h4 class="DarkBlueP "> Metric Name</h4>

                                </div>
                                <div class="col-3">
                                <h4 class="DarkBlueP "> Score<sup class="required">*</sup></h4>
                                </div>
                                <div class="col-3">
                                <h4 class="DarkBlueP "> Self Comment<sup class="required">*</sup></h4>
                                </div>
                                </div>*@
                                @for (int i = EffortList + BevList - 1; i < EffortList + BevList + JobList - 1; i++)
                                {
                                    var temp = i + 1;
                                    int count = i + 2;
                                    <div class="row pt-3 m-3 " style="border:1px solid lightgrey;width:93%;border-radius:0.2rem">
                                        <div class="row">
                                            <div class="col-9"><h4 class="HEADMetrics"> @count .  @Model[temp].Metric_Description </h4></div>
                                            <div class="col-3"> <span style="color:black;font-style:italic;font-size:13px"> (Weightage @Model[temp].metric_Weightage pts) </span> </div>
                                            @* <div class="col-3">
                                        <div class="row d-flex justify-content-center align-items-center">
                                        <div class="col-5">
                                        <label>Score</label>
                                        </div>
                                        <div class="col-7">
                                        <input class=" form-control my-2 kra-score" asp-for="@Model[i].Score" min="1" max="5" type="number" />
                                        </div>
                                        <span asp-validation-for="@Model[i].Score" class="text-danger mx-1 small"></span>
                                        </div>
                                        </div>*@
                                        </div>
                                        <div class="row pt-3 pb-1">
                                            <div class="col-3">
                                                <h4 class="DarkBlueP "> Score<sup class="required">*</sup></h4>

                                            </div>
                                            <div class="col-9">
                                                <h4 class="DarkBlueP "> Self Comment<sup class="required">*</sup></h4>
                                            </div>

                                        </div>
                                        <div class="row pb-3">
                                            <div class="col-3">
                                                <div class="row d-flex justify-content-center align-items-center">
                                                    @* <div class="col-5">
                                                <label>Score</label>
                                                </div>*@
                                                    <div class="col-12">
                                                        @*<input class=" form-control my-2 kra-score" asp-for="@Model[temp].Score" min="1" max="5" type="number" />*@
                                                        <select required asp-for="@Model[temp].Score" class="form-control form-select p-3">
                                                            <option value="">Pts</option>
                                                            <option value=1>1</option>
                                                            <option value="2">2</option>
                                                            <option value="3">3</option>
                                                            <option value="4">4</option>
                                                            <option value="5">5</option>



                                                        </select>
                                                    </div>
                                                    @*  <span asp-validation-for="@Model[temp].Score" class="text-danger mx-1 small"></span>*@
                                                </div>
                                            </div>
                                            <div class="col-9">
                                                <input asp-for="@Model[temp].Metric_ID" hidden value="@Model[temp].Metric_ID" type="number">
                                                <input asp-for="@Model[temp].Id" hidden value="@Model[temp].Id" type="number">
                                                <input asp-for="@Model[temp].List_Id" hidden value="@Model[temp].List_Id" type="number">
                                                <input asp-for="@Model[temp].metric_Weightage" hidden value="@Model[temp].metric_Weightage" type="number">
                                                <input asp-for="@Model[temp].Metric_Description" hidden value="@Model[temp].Metric_Description" type="text">
                                                <textarea required class="form-control " asp-for="@Model[temp].Comment" placeholder="Add Comment"></textarea>
                                                @* <span  class="text-danger   mx-1 small"></span>*@
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        </fieldset>
                        <div class="form-group text-center">
                            <input type="hidden" name="job" id="job" />
                            <div class="row">
                                <div class="col-3"></div>
                                @{
                                    if (ViewBag.ReadOnlyForm == true)
                                    {

                                        if (ViewBag.ReadOnlyForm == true && ViewBag.IsEditable == 1)
                                        {
                                            <div class="col-3"><input id="submit" type="submit" value="Update" class="   btn btn-block AddAppraisalBtn btn-lg " /></div>

                                            <div class="col-3"><input id="reset" type="reset" value="Reset" class=" btn btn-block ResetButton  btn-lg " /></div>

                                        }
                                        else
                                        {
                                            <div class="col-3"><input id="submit" type="submit" value="Update" class="   btn btn-block AddAppraisalBtn btn-lg " disabled /></div>

                                            <div class="col-3"><input id="reset" type="reset" value="Reset" class=" btn btn-block ResetButton  btn-lg " disabled /></div>

                                        }

                                        //<div class="col-3"><input id="submit" type="submit" value="Request To Edit" class="   btn btn-block AddAppraisalBtn btn-lg "  /></div>
                                        <br />


                                        if (ViewBag.appraisalStatus == 2)
                                        {


                                            @if (ViewBag.appraisalData.Editable == false || ViewBag.appraisalData.Editable == null)

                                            {
                                                <div class="m-5">
                                                    <p> Note: You cannot update this appraisal, Raise a update request. To raise a request <a href="RequestForEdit?fId=@ViewBag.fid&userId=@ViewBag.uid ">Click here..</a> </p>

                                                </div>
                                            }

                                        }






                                        //@ViewBag.Fid
                                        //@json.userId
                                    }
                                    else
                                    {
                                         <div class="col-3"><input id="submit" type="submit" value="Proceed" class="   btn btn-block AddAppraisalBtn btn-lg " /></div>
                                        <div class="col-3"><input id="reset" type="reset" value="Reset" class=" btn btn-block ResetButton  btn-lg " /></div>
                                       
                                    }
                                }

                                <div class="col-3"></div>
                               

                            </div>

                        </div>
                    </form>

                </div>

            </div>
        </div>
    </div>
</div>



<script>

    const json = []
    const submit = () => {
        event.preventDefault();
        const scoresClassList = document.querySelectorAll(".kra-score");
        scoresClassList.forEach(item => {
            let comment = document.getElementById(item.getAttribute("name"));
            let obj = {
                MetricId: item.dataset.id,
                KraListId: item.dataset.kraid,
                MetricDescription: item.getAttribute("name"),
                MetricWeihtage: item.dataset.weightage,
                Score: item.value,
                Comment: comment.value
            }
            json.push(obj);
        })
        console.log(json);
    }
</script>



<script>
    (function() {
        'use strict'

        // Fetch all the forms we want to apply custom Bootstrap validation styles to
        var forms = document.querySelectorAll('.needs-validation')

        // Loop over them and prevent submission
        Array.prototype.slice.call(forms)
            .forEach(function(form) {
                form.addEventListener('submit', function(event) {
                    if (!form.checkValidity()) {
                        event.preventDefault()
                        event.stopPropagation()
                    }

                    form.classList.add('was-validated')
                }, false)
            })
    })()
</script>



@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    }
    <script src="./lib/assets/vendors/js/vendor.bundle.base.js"></script>

    <!-- endinject -->
    <!-- Plugin js for this page -->
    <!-- End plugin js for this page -->
    <!-- inject:js -->
    <script src="./lib/assets/js/off-canvas.js"></script>


    <script src="./lib/assets/js/hoverable-collapse.js"></script>

    <script src="./lib/assets/js/misc.js"></script>
    <!-- endinject -->

    <script src="~/lib/assets/vendors/js/vendor.bundle.base.js"></script>

    @*<script src="assets/vendors/chart.js/Chart.min.js"></script>*@
    <script src=" ~/lib/assets/vendors/chart.js/Chart.min.js"></script>
    @*    <script src="assets/js/jquery.cookie.js" type="text/javascript"></script>*@
    <script src=" ~/lib/assets/js/jquery.cookie.js" type="text/javascript"></script>
    @*<script src="assets/js/off-canvas.js"></script>
    <script src="assets/js/hoverable-collapse.js"></script>
    <script src="assets/js/misc.js"></script>*@
    <script src=" ~/lib/assets/js/off-canvas.js"></script>
    <script src=" ~/lib/assets/js/hoverable-collapse.js"></script>
    <script src=" ~/lib/assets/js/misc.js"></script>
    <script>
        (function() {
            'use strict'

            // Fetch all the forms we want to apply custom Bootstrap validation styles to
            var forms = document.querySelectorAll('.needs-validation')

            // Loop over them and prevent submission
            Array.prototype.slice.call(forms)
                .forEach(function(form) {
                    form.addEventListener('submit', function(event) {
                        if (!form.checkValidity()) {
                            event.preventDefault()
                            event.stopPropagation()
                        }

                        form.classList.add('was-validated')
                    }, false)
                })
        })()
    </script>
    @if (ViewBag.ReadOnlyForm == true && ViewBag.IsEditable == 0)
{
    <script>
        document.addEventListener("DOMContentLoaded", function(event) {
            const inputs = document.querySelectorAll('select');
            const comments = document.querySelectorAll('textarea');
            inputs.forEach(input => {
                input.setAttribute("disabled", "true");
            });
            comments.forEach(input => {
                input.readOnly = true;
            })

        });
    </script>
}
